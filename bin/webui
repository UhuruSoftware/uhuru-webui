#!/usr/bin/env ruby

$:.unshift(File.expand_path("../../lib", __FILE__))
home = File.join(File.dirname(__FILE__), '/..')
ENV['BUNDLE_GEMFILE'] = "#{home}/Gemfile"
require "rubygems"
require "bundler/setup"
require "runner"
require "fileutils"

template_apps_dir = Pathname.new("#{home}/template_apps").children.select { |c| c.directory? }
curent_image_files = Pathname.new("#{home}/public/images/apps_logos")

Dir.glob(curent_image_files.to_s + '/*.png').each do |file|
  FileUtils.remove file
end

template_apps_dir.each do |directory|
  subdirectoryes = Pathname.new(directory).children.select { |c| c.directory? }
  subdirectoryes.each do |sub|
    Dir.glob(sub.to_s + '/*.png').each do |file|
      FileUtils.cp file, "#{home}/public/images/apps_logos"
    end
  end
  Dir.glob(directory.to_s + '/*.png').each do |collection_logo|
    FileUtils.cp collection_logo, "#{home}/public/images/apps_logos"
  end
end


Uhuru::Webui::Runner.new(ARGV).run!

